# üß™ Guia de Testes com WhatsApp Stub

## üìã √çndice
- [Vis√£o Geral](#vis√£o-geral)
- [O que √© o Stub?](#o-que-√©-o-stub)
- [Cen√°rio: Chat de Suporte](#cen√°rio-chat-de-suporte)
- [Passo a Passo Completo](#passo-a-passo-completo)
- [Exemplos de C√≥digo Frontend](#exemplos-de-c√≥digo-frontend)
- [Simulando Mensagens do Cliente](#simulando-mensagens-do-cliente)
- [Fluxo Completo de Intera√ß√£o](#fluxo-completo-de-intera√ß√£o)
- [Troubleshooting](#troubleshooting)

---

## üéØ Vis√£o Geral

Este guia explica como testar a funcionalidade de chat de suporte no frontend usando o **WhatsApp Stub** do backend. O stub simula completamente o comportamento do WhatsApp Web sem precisar de uma conta real ou conex√£o com os servidores do WhatsApp.

---

## ü§ñ O que √© o Stub?

O **Stub do WhatsApp** (`integrations/whatsapp_stub.py`) √© um servi√ßo mock que:

‚úÖ **Simula** todos os estados de conex√£o WhatsApp
‚úÖ **Emite** eventos em tempo real via WebSocket
‚úÖ **Persiste** mensagens no banco de dados
‚úÖ **Permite** injetar mensagens de entrada para testes
‚úÖ **Funciona** sem conex√£o externa real

### Estados Simulados

```
disconnected ‚Üí connecting ‚Üí qrcode ‚Üí authenticated ‚Üí ready
```

- **disconnected**: Sem conex√£o
- **connecting**: Iniciando conex√£o
- **qrcode**: QR Code dispon√≠vel para "leitura" (simulado)
- **authenticated**: Autenticado (ap√≥s "ler" QR Code)
- **ready**: Pronto para enviar/receber mensagens

---

## üí¨ Cen√°rio: Chat de Suporte

### Objetivo
Simular um **cliente iniciando um chat de suporte** e um **atendente respondendo**.

### Atores
1. **Cliente**: Envia mensagem "Ol√°, preciso de ajuda"
2. **Atendente** (voc√™ no frontend): Recebe a mensagem e responde

---

## üìù Passo a Passo Completo

### 1Ô∏è‚É£ Autenticar no Backend

Primeiro, fa√ßa login para obter o token JWT:

```bash
POST http://localhost:8001/api/v1/auth/token/
Content-Type: application/json

{
  "username": "admin",
  "password": "sua_senha"
}
```

**Resposta:**
```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc..."
}
```

üíæ **Salve o token `access`** para usar nas pr√≥ximas requisi√ß√µes.

---

### 2Ô∏è‚É£ Conectar ao WebSocket

Estabele√ßa conex√£o WebSocket para receber eventos em tempo real:

```javascript
const token = 'seu_token_jwt_aqui';
const ws = new WebSocket(`ws://localhost:8001/ws/whatsapp/?token=${token}`);

ws.onopen = () => {
  console.log('‚úÖ Conectado ao WebSocket WhatsApp');
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('üì© Evento recebido:', data);
  
  // Processar eventos (detalhes abaixo)
  handleWhatsAppEvent(data);
};

ws.onerror = (error) => {
  console.error('‚ùå Erro WebSocket:', error);
};
```

---

### 3Ô∏è‚É£ Iniciar Sess√£o WhatsApp

Inicie a sess√£o para "conectar" ao WhatsApp (simulado):

```javascript
async function startWhatsAppSession() {
  const response = await fetch('http://localhost:8001/api/v1/whatsapp/sessions/start/', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  });
  
  const data = await response.json();
  console.log('üöÄ Sess√£o iniciada:', data);
  // { session_id: 1, status: "connecting", message: "Sess√£o iniciada com sucesso" }
}

startWhatsAppSession();
```

---

### 4Ô∏è‚É£ Aguardar Eventos de Conex√£o

O stub enviar√° automaticamente os eventos de conex√£o via WebSocket:

```javascript
function handleWhatsAppEvent(data) {
  switch(data.type) {
    case 'session_status':
      console.log(`üìä Status: ${data.status}`);
      
      if (data.status === 'qrcode') {
        console.log('üì± Aguardando QR Code...');
      } else if (data.status === 'ready') {
        console.log('‚úÖ Sess√£o pronta! Pode enviar/receber mensagens.');
        // Sess√£o pronta para uso
        onSessionReady();
      }
      break;
      
    case 'qrcode':
      console.log('üî≤ QR Code dispon√≠vel (base64):', data.image_b64);
      // Voc√™ pode exibir o QR Code na tela (mas √© apenas simula√ß√£o)
      displayQRCode(data.image_b64);
      break;
      
    case 'message_received':
      console.log('üì® Nova mensagem recebida!');
      handleIncomingMessage(data);
      break;
      
    case 'message_status':
      console.log(`üìÆ Status da mensagem ${data.message_id}: ${data.status}`);
      updateMessageStatus(data.message_id, data.status);
      break;
  }
}
```

**Sequ√™ncia de eventos que voc√™ receber√°:**

```
1. { type: "session_status", status: "connecting" }
2. { type: "session_status", status: "qrcode" }
3. { type: "qrcode", image_b64: "..." }
4. { type: "session_status", status: "authenticated" }
5. { type: "session_status", status: "ready" }  ‚Üê PRONTO!
```

‚è±Ô∏è Por padr√£o, essa sequ√™ncia leva **~300ms** (100ms entre cada transi√ß√£o).

---

### 5Ô∏è‚É£ Simular Cliente Enviando Mensagem

Agora que a sess√£o est√° `ready`, voc√™ pode **injetar uma mensagem de entrada** simulando um cliente.

Existem **2 formas** de fazer isso:

#### Op√ß√£o A: Via API REST (‚úÖ **Recomendado - Mais Simples**)

```javascript
async function injectCustomerMessage() {
  const response = await fetch('http://localhost:8001/api/v1/whatsapp/inject-incoming/', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      from: "5511999887766",
      payload: {
        type: "text",
        text: "Ol√°, preciso de ajuda com meu pedido!",
        contact_name: "Jo√£o Silva"
      }
    })
  });
  
  const data = await response.json();
  console.log('‚úÖ Mensagem injetada:', data);
  // {
  //   message: "Mensagem de teste injetada com sucesso",
  //   message_id: "msg_abc123",
  //   database_id: 42,
  //   data: { ... } // Objeto completo da mensagem
  // }
}
```

**Vantagens:**
- ‚úÖ N√£o precisa de WebSocket aberto
- ‚úÖ Mais f√°cil para testes automatizados
- ‚úÖ Funciona com Postman/Insomnia
- ‚úÖ Retorna confirma√ß√£o imediata

#### Op√ß√£o B: Via WebSocket

```javascript
// Enviar mensagem simulada do cliente via WebSocket
function simulateCustomerMessage() {
  const incomingMessage = {
    type: "inject_incoming",
    from: "5511999887766",  // N√∫mero do "cliente"
    chat_id: "5511999887766",
    payload: {
      type: "text",
      text: "Ol√°, preciso de ajuda com meu pedido!",
      contact_name: "Jo√£o Silva"
    }
  };
  
  ws.send(JSON.stringify(incomingMessage));
  console.log('üì§ Mensagem do cliente simulada enviada');
}

// Chamar quando sess√£o estiver ready
function onSessionReady() {
  console.log('‚úÖ Sess√£o pronta! Simulando mensagem de cliente...');
  
  // Aguardar 1 segundo e simular mensagem
  setTimeout(() => {
    simulateCustomerMessage();
  }, 1000);
}
```

**Vantagens:**
- ‚úÖ Tempo real
- ‚úÖ Recebe confirma√ß√£o via WS (`inject_success` ou `inject_error`)

---

### 6Ô∏è‚É£ Receber Mensagem do Cliente

Quando voc√™ injetar a mensagem, receber√° via WebSocket:

```javascript
function handleIncomingMessage(data) {
  console.log('üì® NOVA MENSAGEM RECEBIDA!');
  console.log('De:', data.from);              // "5511999887766"
  console.log('Chat:', data.chat_id);         // "5511999887766"
  console.log('Texto:', data.payload.text);   // "Ol√°, preciso de ajuda com meu pedido!"
  console.log('Nome:', data.payload.contact_name); // "Jo√£o Silva"
  
  // Exibir na interface do chat
  displayMessageInChat({
    id: data.message_id,
    from: data.payload.contact_name || data.from,
    text: data.payload.text,
    direction: 'incoming',
    timestamp: new Date()
  });
  
  // Tocar notifica√ß√£o sonora
  playNotificationSound();
}
```

**Exemplo de evento recebido:**

```json
{
  "type": "message_received",
  "message_id": "msg_1697123456789",
  "from": "5511999887766",
  "chat_id": "5511999887766",
  "payload": {
    "type": "text",
    "text": "Ol√°, preciso de ajuda com meu pedido!",
    "contact_name": "Jo√£o Silva"
  },
  "ts": "2025-10-12T10:30:00Z"
}
```

---

### 7Ô∏è‚É£ Responder Mensagem (Atendente)

Agora voc√™ (como atendente) pode responder ao cliente:

```javascript
async function sendReplyToCustomer(to, text) {
  const response = await fetch('http://localhost:8001/api/v1/whatsapp/send/', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      to: to,  // "5511999887766"
      type: "text",
      text: text,  // "Ol√° Jo√£o! Como posso ajud√°-lo?"
      client_message_id: `my_msg_${Date.now()}`  // ID opcional para rastrear
    })
  });
  
  const data = await response.json();
  console.log('‚úÖ Resposta enviada:', data);
  
  // Exibir na interface
  displayMessageInChat({
    id: data.message_id,
    text: text,
    direction: 'outgoing',
    status: 'queued',
    timestamp: new Date()
  });
  
  return data.message_id;
}

// Exemplo de uso
sendReplyToCustomer("5511999887766", "Ol√° Jo√£o! Como posso ajud√°-lo?");
```

**Resposta da API:**

```json
{
  "message_id": "msg_xyz789",
  "database_id": 42,
  "status": "queued",
  "message": "Mensagem enfileirada para envio"
}
```

---

### 8Ô∏è‚É£ Acompanhar Status da Mensagem

Ap√≥s enviar, voc√™ receber√° **4 eventos de status** via WebSocket:

```javascript
function updateMessageStatus(messageId, newStatus) {
  console.log(`üìÆ Mensagem ${messageId} ‚Üí ${newStatus}`);
  
  // Atualizar UI da mensagem
  const messageElement = document.getElementById(`msg-${messageId}`);
  if (messageElement) {
    messageElement.classList.remove('queued', 'sent', 'delivered', 'read');
    messageElement.classList.add(newStatus);
    
    // Atualizar √≠cone de status
    updateStatusIcon(messageElement, newStatus);
  }
}

function updateStatusIcon(element, status) {
  const iconMap = {
    'queued': '‚è≥',
    'sent': '‚úì',
    'delivered': '‚úì‚úì',
    'read': '‚úì‚úì (azul)'
  };
  
  element.querySelector('.status-icon').textContent = iconMap[status];
}
```

**Eventos recebidos (automaticamente):**

```
üìÆ message_status ‚Üí queued      (imediato)
üìÆ message_status ‚Üí sent        (~50ms depois)
üìÆ message_status ‚Üí delivered   (~100ms depois)
üìÆ message_status ‚Üí read        (~150ms depois)
```

---

## üíª Exemplos de C√≥digo Frontend

### Exemplo Completo React/Vue/JS Puro

```javascript
class WhatsAppChatClient {
  constructor(apiUrl, token) {
    this.apiUrl = apiUrl;
    this.token = token;
    this.ws = null;
    this.sessionId = null;
    this.messages = [];
    this.eventHandlers = {};
  }
  
  // Conectar WebSocket
  connect() {
    this.ws = new WebSocket(`ws://${this.apiUrl}/ws/whatsapp/?token=${this.token}`);
    
    this.ws.onopen = () => {
      console.log('‚úÖ WebSocket conectado');
      this.emit('connected');
    };
    
    this.ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      this.handleEvent(data);
    };
    
    this.ws.onerror = (error) => {
      console.error('‚ùå Erro WebSocket:', error);
      this.emit('error', error);
    };
  }
  
  // Iniciar sess√£o
  async startSession() {
    const response = await fetch(`http://${this.apiUrl}/api/v1/whatsapp/sessions/start/`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.token}`,
        'Content-Type': 'application/json'
      }
    });
    
    const data = await response.json();
    this.sessionId = data.session_id;
    this.emit('session_started', data);
    return data;
  }
  
  // Enviar mensagem
  async sendMessage(to, text) {
    const response = await fetch(`http://${this.apiUrl}/api/v1/whatsapp/send/`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        to: to,
        type: 'text',
        text: text,
        client_message_id: `msg_${Date.now()}`
      })
    });
    
    const data = await response.json();
    
    // Adicionar √† lista local
    this.messages.push({
      id: data.message_id,
      to: to,
      text: text,
      direction: 'outgoing',
      status: 'queued',
      timestamp: new Date()
    });
    
    this.emit('message_sent', data);
    return data;
  }
  
  // Simular mensagem recebida (TESTE)
  simulateIncoming(from, text, contactName = null) {
    const message = {
      type: "inject_incoming",
      from: from,
      chat_id: from,
      payload: {
        type: "text",
        text: text,
        contact_name: contactName || from
      }
    };
    
    this.ws.send(JSON.stringify(message));
  }
  
  // Manipular eventos
  handleEvent(data) {
    switch(data.type) {
      case 'session_status':
        this.emit('session_status', data.status);
        if (data.status === 'ready') {
          this.emit('ready');
        }
        break;
        
      case 'qrcode':
        this.emit('qrcode', data.image_b64);
        break;
        
      case 'message_received':
        this.messages.push({
          id: data.message_id,
          from: data.from,
          text: data.payload.text,
          direction: 'incoming',
          contactName: data.payload.contact_name,
          timestamp: new Date(data.ts)
        });
        this.emit('message_received', data);
        break;
        
      case 'message_status':
        const msg = this.messages.find(m => m.id === data.message_id);
        if (msg) {
          msg.status = data.status;
        }
        this.emit('message_status', { id: data.message_id, status: data.status });
        break;
        
      case 'inject_success':
        console.log('‚úÖ Mensagem teste injetada com sucesso');
        break;
    }
  }
  
  // Sistema de eventos
  on(event, handler) {
    if (!this.eventHandlers[event]) {
      this.eventHandlers[event] = [];
    }
    this.eventHandlers[event].push(handler);
  }
  
  emit(event, data) {
    if (this.eventHandlers[event]) {
      this.eventHandlers[event].forEach(handler => handler(data));
    }
  }
}

// USO
const client = new WhatsAppChatClient('localhost:8001', 'seu_token_jwt');

// Configurar handlers
client.on('connected', () => {
  console.log('Conectado!');
  client.startSession();
});

client.on('ready', () => {
  console.log('Sess√£o pronta!');
  
  // Simular cliente enviando mensagem ap√≥s 2 segundos
  setTimeout(() => {
    client.simulateIncoming('5511999887766', 'Ol√°, preciso de ajuda!', 'Jo√£o Silva');
  }, 2000);
});

client.on('message_received', (data) => {
  console.log('Nova mensagem:', data);
  
  // Responder automaticamente (teste)
  setTimeout(() => {
    client.sendMessage(data.from, 'Ol√°! Como posso ajud√°-lo?');
  }, 1000);
});

client.on('message_status', (data) => {
  console.log(`Status da mensagem ${data.id}: ${data.status}`);
});

// Conectar
client.connect();
```

---

## üé≠ Simulando Mensagens do Cliente

### Cen√°rios de Teste

#### 1. Cliente Iniciando Conversa

```javascript
// Cliente: "Ol√°, preciso de ajuda"
client.simulateIncoming('5511999887766', 'Ol√°, preciso de ajuda!', 'Jo√£o Silva');

// Aguardar 2 segundos e responder
setTimeout(() => {
  client.sendMessage('5511999887766', 'Ol√° Jo√£o! Como posso ajud√°-lo?');
}, 2000);
```

#### 2. M√∫ltiplas Mensagens do Cliente

```javascript
// Simular conversa completa
const conversation = [
  { from: '5511999887766', text: 'Ol√°, preciso de ajuda!', name: 'Jo√£o Silva' },
  { delay: 2000, reply: 'Ol√° Jo√£o! Como posso ajud√°-lo?' },
  { from: '5511999887766', text: 'N√£o consigo acessar meu painel' },
  { delay: 1500, reply: 'Entendo. Vou verificar sua conta. Um momento...' },
  { from: '5511999887766', text: 'Ok, obrigado!' },
];

async function simulateConversation() {
  for (const step of conversation) {
    if (step.from) {
      // Mensagem do cliente
      client.simulateIncoming(step.from, step.text, step.name);
      await sleep(500);
    } else if (step.reply) {
      // Resposta do atendente
      await sleep(step.delay);
      await client.sendMessage('5511999887766', step.reply);
    }
  }
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// Executar quando pronto
client.on('ready', () => {
  simulateConversation();
});
```

#### 3. M√∫ltiplos Clientes

```javascript
// Simular 3 clientes diferentes enviando mensagens
const customers = [
  { phone: '5511999887766', name: 'Jo√£o Silva', message: 'Ol√°, preciso de suporte' },
  { phone: '5511988776655', name: 'Maria Santos', message: 'Meu sistema est√° lento' },
  { phone: '5511977665544', name: 'Carlos Oliveira', message: 'Como fa√ßo upgrade?' },
];

customers.forEach((customer, index) => {
  setTimeout(() => {
    client.simulateIncoming(customer.phone, customer.message, customer.name);
  }, index * 3000);  // 3 segundos entre cada
});
```

#### 4. Mensagens com M√≠dia (Simulado)

```javascript
// Simular recebimento de imagem
client.simulateIncoming('5511999887766', '[Imagem]', 'Jo√£o Silva');

// Ou com payload completo via API
fetch('http://localhost:8001/api/v1/whatsapp/inject-incoming/', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    from: "5511999887766",
    payload: {
      type: "image",
      media_url: "https://example.com/image.jpg",
      text: "Olha essa imagem!",
      contact_name: "Jo√£o Silva",
      mime_type: "image/jpeg",
      media_size: 125000
    }
  })
});
```

---

## üîÑ Fluxo Completo de Intera√ß√£o

### Diagrama de Sequ√™ncia

```
Frontend                  Backend (Stub)              Database
   |                           |                          |
   |-- POST /start ----------->|                          |
   |                           |-- save session --------->|
   |<-- {status:connecting} ---|                          |
   |                           |                          |
   |<-- WS: connecting --------|                          |
   |<-- WS: qrcode ------------|                          |
   |<-- WS: authenticated -----|                          |
   |<-- WS: ready -------------|                          |
   |                           |                          |
   |-- WS: inject_incoming --->|                          |
   |                           |-- save message --------->|
   |<-- WS: message_received --|                          |
   |                           |                          |
   |-- POST /send ------------>|                          |
   |                           |-- save message --------->|
   |<-- {status:queued} -------|                          |
   |                           |                          |
   |<-- WS: status:queued -----|                          |
   |<-- WS: status:sent -------|-- update status -------->|
   |<-- WS: status:delivered --|-- update status -------->|
   |<-- WS: status:read -------|-- update status -------->|
```

### Timeline T√≠pica

```
T+0ms     ‚Üí Conectar WebSocket
T+50ms    ‚Üí POST /start (iniciar sess√£o)
T+100ms   ‚Üí WS: connecting
T+200ms   ‚Üí WS: qrcode
T+300ms   ‚Üí WS: authenticated
T+400ms   ‚Üí WS: ready ‚úÖ
T+1000ms  ‚Üí Simular mensagem cliente (inject_incoming)
T+1050ms  ‚Üí WS: message_received
T+3000ms  ‚Üí POST /send (responder)
T+3050ms  ‚Üí WS: message_status ‚Üí queued
T+3100ms  ‚Üí WS: message_status ‚Üí sent
T+3150ms  ‚Üí WS: message_status ‚Üí delivered
T+3200ms  ‚Üí WS: message_status ‚Üí read
```

---

## üêõ Troubleshooting

### Problema 1: WebSocket n√£o conecta

**Sintoma:** `WebSocket connection failed`

**Solu√ß√µes:**
```javascript
// 1. Verificar URL correta
const ws = new WebSocket('ws://localhost:8001/ws/whatsapp/?token=SEU_TOKEN');

// 2. Verificar token v√°lido
console.log('Token:', token);

// 3. Verificar CORS (se frontend em porta diferente)
// Backend j√° est√° configurado para aceitar conex√µes
```

### Problema 2: Mensagens n√£o aparecem

**Sintoma:** `inject_incoming` n√£o retorna mensagem

**Solu√ß√µes:**
```javascript
// 1. Garantir que sess√£o est√° "ready"
client.on('ready', () => {
  // S√ì AQUI voc√™ pode enviar/injetar mensagens
  client.simulateIncoming(...);
});

// 2. Verificar estrutura do payload
const correctPayload = {
  type: "inject_incoming",  // ‚Üê tipo correto
  from: "5511999999999",
  chat_id: "5511999999999",
  payload: {  // ‚Üê payload aninhado
    type: "text",
    text: "Mensagem",
    contact_name: "Nome"
  }
};
```

### Problema 3: Status n√£o atualiza

**Sintoma:** Mensagem fica em "queued" para sempre

**Verificar:**
```javascript
// 1. Listener do WebSocket est√° ativo?
ws.onmessage = (event) => {
  console.log('Evento:', JSON.parse(event.data));  // ‚Üê Verificar aqui
};

// 2. Handler de message_status implementado?
client.on('message_status', (data) => {
  console.log('Status atualizado:', data);
});
```

### Problema 4: Eventos duplicados

**Sintoma:** Recebe 2x cada mensagem

**Solu√ß√£o:**
```javascript
// N√£o criar m√∫ltiplas conex√µes!
// ERRADO:
setInterval(() => {
  const ws = new WebSocket(...);  // ‚ùå Nova conex√£o a cada loop
}, 1000);

// CERTO:
const ws = new WebSocket(...);  // ‚úÖ Uma √∫nica conex√£o
```

---

## üéØ Checklist de Testes

### Frontend deve suportar:

- [ ] Conectar WebSocket com token JWT
- [ ] Iniciar sess√£o via API
- [ ] Exibir progresso de conex√£o (connecting ‚Üí qrcode ‚Üí ready)
- [ ] Exibir QR Code (mesmo sendo simulado)
- [ ] Receber mensagens via WebSocket
- [ ] Exibir mensagens recebidas na UI
- [ ] Enviar mensagens via API
- [ ] Atualizar status das mensagens (‚úì, ‚úì‚úì, lido)
- [ ] Tocar notifica√ß√£o sonora ao receber mensagem
- [ ] Mostrar indicador de digita√ß√£o (se implementado)
- [ ] Listar hist√≥rico de mensagens via API
- [ ] Filtrar mensagens por chat
- [ ] Reconectar WebSocket se cair

---

## üìö Refer√™ncias

- **Documenta√ß√£o completa**: [`WHATSAPP_SESSION_EVENTS.md`](./WHATSAPP_SESSION_EVENTS.md)
- **API Reference**: [`API_REFERENCE.md`](./API_REFERENCE.md)
- **C√≥digo do Stub**: `integrations/whatsapp_stub.py`
- **WebSocket Consumer**: `whatsapp/consumers.py`
- **Servi√ßo**: `whatsapp/service.py`

---

## üöÄ Pr√≥ximos Passos

Ap√≥s testar com o stub:

1. ‚úÖ Validar UI/UX do chat
2. ‚úÖ Testar performance com m√∫ltiplos clientes
3. ‚úÖ Implementar recursos avan√ßados (digita√ß√£o, leitura, etc)
4. üîÑ Trocar stub por integra√ß√£o real quando pronto
5. üìä Monitorar m√©tricas de lat√™ncia em produ√ß√£o

---

**üí° Dica Final:** O stub est√° configurado para ser **r√°pido** em testes. Se quiser simular lat√™ncia real, configure a vari√°vel de ambiente `WHATSAPP_STUB_FAST=0` para ter delays mais realistas entre transi√ß√µes de estado.

